<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: phpunit | Matthieu Napoli]]></title>
  <link href="http://mnapoli.fr/categories/phpunit/atom.xml" rel="self"/>
  <link href="http://mnapoli.fr/"/>
  <updated>2016-10-31T12:10:04+01:00</updated>
  <id>http://mnapoli.fr/</id>
  <author>
    <name><![CDATA[Matthieu Napoli]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Doctrine schema validation in a PHPUnit test]]></title>
    <link href="http://mnapoli.fr/doctrine-schema-validation-in-a-phpunit-test/"/>
    <updated>2012-12-10T20:00:00+01:00</updated>
    <id>http://mnapoli.fr/doctrine-schema-validation-in-a-phpunit-test</id>
    <content type="html"><![CDATA[<p>Doctrine offers a <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/tools.html#runtime-vs-development-mapping-validation">command line option to validate the schema</a> (or mapping):</p>

<p><code>
./doctrine orm:validate-schema
</code></p>

<p>This is very useful, when I ran it against my code, which was <em>working</em> by the way, I got several errors/warnings.</p>

<p>However, I didnâ€™t want to have to run this tool manually once in a while. I already have tests for that. So I thought: <strong>why not integrating the schema validation to the tests!</strong></p>

<!-- more -->


<p>So here is my implementation of a PHPUnit test failing when Doctrine validation find errors:</p>

<p><div><script src='https://gist.github.com/4249675.js'></script>
<noscript><pre><code>&lt;?php
/**
 * @author Matthieu Napoli
 * @link http://en.mnapoli.fr/doctrine-schema-validation-in-a-phpunit-test/
 * @license WTFPL - Do What The Fuck You Want To Public License (http://sam.zoy.org/wtfpl/)
 */

use Doctrine\ORM\Tools\SchemaValidator;

/**
 * Doctrine schema validation
 */
class SchemaValidationTest extends PHPUnit_Framework_TestCase
{

    /**
     * @var \Doctrine\ORM\EntityManager
     */
    protected $entityManager;

    public function setUp() {
        $this-&gt;entityManager = /* inject your entity manager here */;
    }

    public function testValidateSchema() {
        $validator = new SchemaValidator($this-&gt;entityManager);
        $errors = $validator-&gt;validateMapping();

        if (count($errors) &gt; 0) {
            $message = PHP_EOL;
            foreach ($errors as $class =&gt; $classErrors) {
                $message .= &quot;- &quot; . $class . &quot;:&quot; . PHP_EOL . implode(PHP_EOL, $classErrors) . PHP_EOL . PHP_EOL;
            }
            $this-&gt;fail($message);
        }
    }

}</code></pre></noscript></div>
</p>
]]></content>
  </entry>
  
</feed>
